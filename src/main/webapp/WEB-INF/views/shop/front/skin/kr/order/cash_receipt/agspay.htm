<!---------------------------------------------------------
1)신분확인번호는 구분기호없이 숫자만 입력하여 주십시오.
2)소득공제용신청시 신분확인번호에 주민(핸드폰)번호를 소득지출증빙용선택시 사업자번호를 입력하여 주십시오
3)거래자구분에 따라서 신분확인번호를 입력하여 주십시오.
4)원거래승인번호는 취소시 입력하여 주시기 바랍니다.
5)결제금액이 5000원이상이어야 합니다. 공급가액/부가세/봉사료의 합이 결제금액과 맞아야 합니다.
6)결제종류 선택시 취소요청은 상점에서만 사용하시기 바랍니다.

☞ 표시는 필수 입력사항입니다.
---------------------------------------------------------->
<script language=javascript>

<!--
function GBC1(){

	document.cash_pay.Gubun_cd.value="01" // 소비자 소득공제용

}

function GBC2(){

	document.cash_pay.Gubun_cd.value="02" // 사업자 지출증빙용


}

function send_form(){

	form_name = document.cash_pay;

	// 주민(핸드폰)번호 체크 - 주민(핸드폰)번호 13(10,11)자리입력시 체크함
	if (form_name.Gubun_cd.value =="01"){
	  	alert("소득공제용 현금영수증을 선택했습니다.");
    	if( !(form_name.Confirm_no.value.length == 10 || form_name.Confirm_no.value.length == 11 || form_name.Confirm_no.value.length == 13)) {
			alert("주민등록번호 13자리 또는 핸드폰 번호 10,11자리를 입력하세요.");
			return false;
	    }
	    if(form_name.Confirm_no.value.length == 13) {
		  	var obj = form_name.Confirm_no.value;
          	var sum=0;

           	for(i=0;i<8;i++) { sum+=obj.substring(i,i+1)*(i+2); }

           	for(i=8;i<12;i++) { sum+=obj.substring(i,i+1)*(i-6); }

	       	sum=11-(sum%11);

		   	if (sum>=10) { sum-=10; }

           	if (obj.substring(12,13) != sum || (obj.substring(6,7) !=1 && obj.substring(6,7) != 2))	{
           	    alert("주민등록번호에 오류가 있습니다. 다시 확인하십시오.");
           	    return false;
		   	}
        }
    }

	 // 사업자 번호 체크 - 사업자번호10자리 입력시  체크함

	 if (form_name.Gubun_cd.value =="02"){
		  alert("지출증빙용 현금영수증을 선택했습니다.");
		if(form_name.Confirm_no.value.length != 10)
		{
			alert("사업자번호 10자리를 입력하세요.");
			return false;
		}
		else if(form_name.Confirm_no.value.length == 10) {

	        var  obj = form_name.Confirm_no.value;
    			var sum = 0;

    			var getlist =new Array(10);

    			var chkvalue =new Array("1","3","7","1","3","7","1","3","5");

    			for(var i=0; i<10; i++) { getlist[i] = obj.substring(i, i+1); }

    			for(var i=0; i<9; i++) { sum += getlist[i]*chkvalue[i]; }

    			sum = sum + parseInt((getlist[8]*5)/10);

    			sidliy = sum % 10;

    			sidchk = 0;

    			if(sidliy != 0) { sidchk = 10 - sidliy; }

    			else { sidchk = 0; }

    			if(sidchk != getlist[9]){
    				alert("사업자등록번호에 오류가 있습니다. 다시 확인하십시오.");
    				return;
    			}

	        }
		 }
       //입력확인스크립트
	    if (form_name.Pay_kind.value == ""){
			alert("결제종류를 입력해 주세요.");
			return false;
		}

		if (form_name.Retailer_id.value == ""){
			alert("서비스아이디를 입력해 주세요.");
			return false;
		}

		if (form_name.Cust_no.value == ""){
			alert("회원아이디를 입력해 주세요.");
			return false;
		}

		if (form_name.Order_no.value == ""){
			alert("주문번호를 입력해 주세요.");
			return false;
		}

		if (form_name.Amtcash.value == ""){
			alert("거래금액을 입력해 주세요.");
			return false;
		}

		if (form_name.Amttex.value == ""){
		    alert("부가가치세를 입력해 주세요.");
	     	return false;
		}

		if (form_name.Amtadd.value == ""){
		    alert("봉사료를 입력해 주세요.");
		    return false;
		}

		if (form_name.Confirm_no.value ==""){
		    alert("신분확인번호 를 입력해 주세요");
			return false;
		}

	// 결제금액이 5000 원 이상이어야 함
	// 현금결제금액 합산은 아래의 자바스크립트를 통해 반드시 확인 하도록 하시기 바라며,
	// 아래의 자바스크립트를 사용하지 않아 발생된 문제는 상점에 책임이 있습니다.
	   var sum_deal = eval(form_name.deal_won.value) + eval(form_name.Amttex.value) + eval(form_name.Amtadd.value);
       if(form_name.Amtcash.value != sum_deal)
       {
	 	   alert("결제금액이 맞지 않습니다.");
		   return false;
	   }
	   else if(sum_deal < 5000)
	   {
		   alert("총결제금액이 5천원 이상이어야 현금영수증 발행이 가능합니다.");
		   return false;
	   }
	 //중복요청 방지를 위해서 confirm 을 실행해야함
	   if(confirm("현금영수증을 발행하시겠습니까?"))
	   {
	       form_name.submit();
		   return true;

	   } else {
		return false;
	   }

	}

-->
</script>

<table width=100% style="border:1px solid #DEDEDE" cellpadding=0 cellspacing=0>
<tr>
	<td width=150 valign=top align=right bgcolor="#F3F3F3"></td>
	<td id="orderbox">

	<table>
	<col width=100>
	<tr>
		<td>현금영수증</td>
		<td>
		<!--{ ? cashreceipt }-->
		현금영수증이 발급되었습니다. ( 승인번호 : {=cashreceipt} )
		<!--{ : step==4 && step2==0 }-->
		<form name="cash_pay"  method=POST action="../order/card/agspay/AGSCash_ing.php" style="margin:0px;" target="ifrmHidden"> <!--승인요청 및 결과수신페이지 지정 //-->

		<!-- ☞ 결제종류 -->
		<!-- 승인시만 사용하도록 연동할때 -------------->
		<input type=hidden name=Pay_kind value="cash-appr">
        <!-- 취소시만 사용하도록 연동할때 -------------->
		<!--<input type=hidden name=Pay_kind value="cash-cncl"> -->
		<input type=hidden name=Retailer_id value="{_pg.id}"><!-- ☞ 서비스아이디 -->
		<input type=hidden name=Cust_no value="{?_sess.m_id}{_sess.m_id}{:email}{email}{:}guest{/}"><!-- ☞ 회원아이디 -->
		<input type=hidden name=Order_no value="{ordno}"><!-- ☞ 주문번호 -->
		<input type=hidden name=Amtcash value="{settleprice}"><!-- ☞ 결제금액 -->
		<input type=hidden name=deal_won value="{_cashReceipt.supply}"><!-- ☞ 공급가액 -->
		<input type=hidden name=Amttex value="{_cashReceipt.vat}"><!-- ☞ 부가가치세 -->
		<input type=hidden name=Amtadd value="0"><!-- ☞ 봉사료 -->
		<input type=hidden name=prod_nm value="{_item[0]['goodsnm']}"><!-- 상품명 -->
		<input type=hidden name=prod_set value=""><!-- 상품수량 -->
		<!-----------------단말기 번호는 7005037001 셋팅함 (수정불가)----------------------->
		<input type=hidden name=Cat_id value="7005037001">
		<!-----------------결제방식 무통장입금으로 셋팅함 무통장입금-1 , 계좌이체-2 -------------------------->
		<!--{ ? settlekind=="a" }-->
		<input type=hidden name=Pay_type value="1">
		<!--{ : settlekind=="o" }-->
		<input type=hidden name=Pay_type value="2">
		<!--{ / }-->

		<table border=0 cellpadding=0 cellspacing=0 style="margin-bottom:5px;">
		<tr>
			<td>
			소득공제용<input type=radio name=Gubun_cd value="01" Onclick= "javascript:GBC1()">
			&nbsp;&nbsp;&nbsp; 지출증빙용<input type=radio name=Gubun_cd value="02" Onclick= "javascript:GBC2()">
			</td>
		</tr>
		<tr>
         	<td>신분확인번호 <input type=text style=width:100px name=Confirm_no value="" class="line">&nbsp;&nbsp;[주민(핸드폰)번호 & 사업자번호]</td>
		</tr>
		</table>

		</form>
		<input type=button value="현금영수증발급요청" name=app_btn onClick="javascript:send_form();">
		<!--{ / }-->
		</td>
	</tr>
	</table>

	</td>
</tr>
</table>